C51 COMPILER V9.00   GPRS                                                                  05/24/2011 20:52:59 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE GPRS
OBJECT MODULE PLACED IN gprs.OBJ
COMPILER INVOKED BY: D:\Program Files\Keil4\C51\BIN\C51.EXE gprs.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          // File Name: gprs.c
   3          
   4          #include "gprs.h"
   5          #include "systerm.h"
   6          /*////////////////////////////////////////////////////////////////////////////////////////////////////
   7          // º¯ÊýÃû:char Uart2Init(char smod,char brtx12,unsigned char reload)
   8          // ×÷ÓÃ:        ³õÊ¼»¯ÓÃÓÚÁ¬½ÓgprsµÄ´®¿Ú2 ,´®¿Ú2Ö»ÄÜÉèÖÃÎª¶ÀÁ¢²¨ÌØÂÊÌá¹©²¨ÌØÂÊ
   9                                  ²¢´ò¿ª´®¿Ú2ÖÐ¶ÏºÍÈ«¾ÖÖÐ¶Ï
  10          // ²ÎÊý:        smod    s2smodÎ»        0/1
  11                                  brtx12  brtx12Î»  0/1
  12                                  reload  reload¼Ä´æÆ÷ÊýÖµ  0-255
  13          // ·µ»Ø:        -1              s2smodÎ»´íÎó£¬Ã»ÓÐÐ´Èë0/1
  14                                  -2              brtx12Î»´íÎó£¬Ã»ÓÐÐ´Èë0/1
  15                                  0               
  16          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
  17          char Uart2Init(char s2smod,char brtx12,unsigned char reload)
  18          {
  19   1              S2CON = 0X50;//8Î»¿É±ä²¨ÌØÂÊ£¬ÎÞÆæÅ¼Î»
  20   1              BRT     = reload;//ÉèÖÃ¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷²¨ÌØÂÊ
  21   1      
  22   1              if(s2smod == 1)
  23   1              {
  24   2                      AUXR |= S2SMOD;   //S2SMOD = 1;//²¨ÌØÂÊ±¶ËÙÎ»
  25   2              }
  26   1              else if(s2smod == 0)
  27   1              {
  28   2                      AUXR &= (~S2SMOD);   //S2SMOD = 0;//È¡Ïû²¨ÌØÂÊ±¶ËÙÎ»
  29   2              }
  30   1              else
  31   1              {
  32   2                      return -1;
  33   2              }
  34   1                      
  35   1              if(brtx12 == 1)
  36   1              {
  37   2                      AUXR |= BRTx12;//BRTx12 = 1;1TÄ£Ê½      
  38   2              }
  39   1              else if(brtx12 == 0)
  40   1              {
  41   2                      AUXR &= (~BRTx12);//BRTx12 = 0;12TÄ£Ê½          
  42   2              }
  43   1              else
  44   1              {
  45   2                      return -2;
  46   2              }
  47   1                      
  48   1              AUXR |= BRTR;//¿ªÆô²¨ÌØÂÊ·¢ÉúÆ÷                                                                                                                                                         
  49   1              IE2 |= ES2;//   ES2 = 1;           //ÔÊÐí´®¿Ú2ÖÐ¶Ï
  50   1              EA = 1;    //¿ª×ÜÖÐ¶Ï
  51   1              return 0;       
  52   1      }
  53          
  54          /*////////////////////////////////////////////////////////////////////////////////////////////////////
  55          // º¯ÊýÃû:void Uart2Send(char i)
C51 COMPILER V9.00   GPRS                                                                  05/24/2011 20:52:59 PAGE 2   

  56          // ×÷ÓÃ: ÓÃÓÚgprsÁ¬½ÓµÄ´®¿Ú1Ïògps·¢ËÍ1×Ö½ÚÊý¾Ý
  57          // ²ÎÊý:        i       Òª·¢ËÍµÄÊý¾Ý    
  58          // ·µ»Ø:         void
  59          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
  60          void Uart2Send(uchar i)
  61          {
  62   1              unsigned char temp = 0;
  63   1              
  64   1              IE2 &= (~ES2);//¹Ø±Õ´®¿Ú2ÖÐ¶Ï//ES2 = 0;
  65   1              S2CON &= (~S2TI);//S2TI = 0;
  66   1              S2BUF = i;//×°ÈëÊý¾Ý
  67   1              do
  68   1              {
  69   2                      temp = S2CON;
  70   2                      temp = temp & 0x02;//temp = S2TI;
  71   2              }while(temp == 0);//ÅÐ¶ÏÊÇ·ñ·¢ËÍÍê±Ï
  72   1      
  73   1              S2CON &= (~S2TI);//S2TI = 0;
  74   1              IE2 |= ES2;//ES2 = 1;
  75   1                      
  76   1      }
  77          
  78          /*////////////////////////////////////////////////////////////////////////////////////////////////////
  79          // º¯ÊýÃû:void Uart2Sends(char* data_at)
  80          // ×÷ÓÃ:        ·¢ËÍ×Ö·û´®µ½´®¿Ú2 
  81          // ²ÎÊý:        char* data_at ×Ö·û´®Í·µØÖ·
  82          // ·µ»Ø:
  83          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
  84          void Uart2Sends(uchar* data_at)
  85          {
  86   1      
  87   1              unsigned char cnt=0;
  88   1      
  89   1              IE2 &= (~ES2);//¹Ø±Õ´®¿Ú2ÖÐ¶Ï//ES2 = 0;
  90   1              S2CON &= (~S2TI);//S2TI = 0;
  91   1      
  92   1                              
  93   1              while(*(data_at+cnt))   //ÅÐ¶ÏÒ»´®Êý¾ÝÊÇ·ñ½áÊø
  94   1              {
  95   2                      S2BUF = *(data_at+cnt);//×°ÈëÊý¾Ý
  96   2                      while((S2CON & S2TI) == 0);
  97   2                      S2CON &= (~S2TI);//S2TI = 0;
  98   2                      cnt++;
  99   2      
 100   2              }
 101   1      
 102   1              S2CON &= (~S2TI);//S2TI = 0;
 103   1              IE2 |= ES2;//ES2 = 1;           
 104   1      }
 105          
 106          
 107          
 108          
 109          
 110          
 111          /*////////////////////////////////////////////////////////////////////////////////////////////////////
 112          // º¯ÊýÃû:char Uart1Init(char smod,char brtx12,unsigned char reload)
 113          // ×÷ÓÃ:        ³õÊ¼»¯ÓÃÓÚÁ¬½ÓgpsµÄ´®¿Ú1 ,½«´®¿Ú1ÉèÖÃÎ»¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷Ìá¹©²¨ÌØÂÊ£¬
 114                                  ²¢´ò¿ª´®¿Ú1ÖÐ¶ÏºÍÈ«¾ÖÖÐ¶Ï
 115          // ²ÎÊý:        smod    smodÎ»  0/1
 116                                  brtx12  brtx12Î»  0/1
 117                                  reload  reload¼Ä´æÆ÷ÊýÖµ  0-255
C51 COMPILER V9.00   GPRS                                                                  05/24/2011 20:52:59 PAGE 3   

 118          // ·µ»Ø:        -1              smodÎ»´íÎó£¬Ã»ÓÐÐ´Èë0/1
 119                                  -2              brtx12Î»´íÎó£¬Ã»ÓÐÐ´Èë0/1
 120                                  0               
 121          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
 122          //´®¿ÚÉèÖÃÎ»¶ÀÁ¢²¨ÌØÂÊÌá¹©²¨ÌØÂÊ£¬ºÍ´®¿Ú2Ê¹ÓÃÍ¬Ò»¸ö²¨ÌØÂÊ£¬Ò²¿ÉÒÔÊ¹ÓÃ¶¨Ê±Æ÷1À´Ìá¹©²¨ÌØÂÊ
 123          char Uart1Init(char smod,char brtx12,unsigned char reload)
 124          {
 125   1              SCON =  0X50;//8Î»¿É±ä²¨ÌØÂÊ£¬ÎÞÆæÅ¼Î»(SM0=0,SM1=1),Ê¹ÄÜ´®¿Ú½ÓÊÕÄ£¿é(REN=1)
 126   1              BRT     = reload;//ÉèÖÃ¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷²¨ÌØÂÊ
 127   1      
 128   1              if(smod == 1)
 129   1              {
 130   2                      PCON |= SMOD;   //SMOD = 1;//²¨ÌØÂÊ±¶ËÙÎ»
 131   2              }
 132   1              else if(smod == 0)
 133   1              {
 134   2                      PCON &= (~SMOD);   //SMOD = 0;//È¡Ïû²¨ÌØÂÊ±¶ËÙÎ»
 135   2              }
 136   1              else
 137   1              {
 138   2                      return -1;
 139   2              }
 140   1                      
 141   1              if(brtx12 == 1)
 142   1              {
 143   2                      AUXR |= BRTx12;//BRTx12 = 1;1TÄ£Ê½      
 144   2              }
 145   1              else if(brtx12 == 0)
 146   1              {
 147   2                      AUXR &= (~BRTx12);//BRTx12 = 0;12TÄ£Ê½          
 148   2              }
 149   1              else
 150   1              {
 151   2                      return -2;
 152   2              }
 153   1              
 154   1              AUXR |= S1BRS;//´®¿Ú1ÉèÖÃÎªÊ¹ÓÃ¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷                                                                         
 155   1              AUXR |= BRTR;//¿ªÆô²¨ÌØÂÊ·¢ÉúÆ÷                                                                 
 156   1                                                                                              
 157   1              ES = 1;    //¿ª´®¿ÚÖÐ¶Ï
 158   1              EA = 1;    //¿ª×ÜÖÐ¶Ï
 159   1              return 0;       
 160   1      }
 161          
 162          /*////////////////////////////////////////////////////////////////////////////////////////////////////
 163          // º¯ÊýÃû:void Uart1Send(char i)
 164          // ×÷ÓÃ: ÓÃÓÚgpsÁ¬½ÓµÄ´®¿Ú1Ïògps·¢ËÍ1×Ö½ÚÊý¾Ý
 165          // ²ÎÊý:        i       Òª·¢ËÍµÄÊý¾Ý    
 166          // ·µ»Ø:         void
 167          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
 168          void Uart1Send(uchar i)
 169          {
 170   1              ES = 0; //¹Ø´®¿ÚÖÐ¶Ï
 171   1              TI = 0; //Çå¿Õ·¢ËÍÍêÖÐ¶ÏÇëÇó±êÖ¾Î»
 172   1              SBUF = i;  //½«Êý¾Ý·ÅÈë¼Ä´æÆ÷·¢ËÍ
 173   1              while(TI == 0);//µÈ´ý·¢ËÍÍê±Ï£¬·¢ËÍÍê±Ï TI == 1
 174   1              TI = 0; //Çå¿Õ·¢ËÍÍêÖÐ¶ÏÇëÇó±êÖ¾Î»
 175   1              ES = 1;  //¿ª´®¿ÚÖÐ¶Ï   
 176   1      }
 177          
 178          /*////////////////////////////////////////////////////////////////////////////////////////////////////
 179          // º¯ÊýÃû:void Uart1Sends(char* at)
C51 COMPILER V9.00   GPRS                                                                  05/24/2011 20:52:59 PAGE 4   

 180          // ×÷ÓÃ: ·¢ËÍ×Ö·û´®µ½´®¿Ú1
 181          // ²ÎÊý: char* at ×Ö·û´®Í·µØÖ·
 182          // ·µ»Ø:
 183          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
 184          void Uart1Sends(uchar* at)
 185          {
 186   1              unsigned char cnt=0;
 187   1      
 188   1              ES=0;//¹Ø´®ÐÐ¿ÚÖÐ¶Ï     
 189   1              while(*(at+cnt))        //ÅÐ¶ÏÒ»´®Êý¾ÝÊÇ·ñ½áÊø
 190   1              {
 191   2                      SBUF=*(at+cnt); //·¢ËÍÊý¾Ý
 192   2                      while(TI==0);   //²éÑ¯·¢ËÍÊÇ·ñ½áÊø
 193   2                      TI=0;   //Çå³ý·¢ËÍÒ»±êÖ¾Î»
 194   2                      cnt++;  //×¼±¸·¢ËÍÒ»¸öÊý¾Ý
 195   2              }
 196   1              ES=1;//¿ª´®ÐÐ¿ÚÖÐ¶Ï             
 197   1      }
 198          
 199          /*////////////////////////////////////////////////////////////////////////////////////////////////////
 200          // º¯ÊýÃû: void Uart1InterruptReceive(void) interrupt 4
 201          // ×÷ÓÃ:        ½ÓÊÕgpsÄ£¿é´«À´µÄ¶¨Î»ÐÅºÅ£¬²¢½«GPRMCÐÅÏ¢ÖÐµÄ¸÷ÖÖÐÅÏ¢´æÈëgprmc½á¹¹ÌåÄÚ£¬Ïê¼ûgprmc½á¹¹Ìå
 202          // ²ÎÊý:        void
 203          // ·µ»Ø:        void
 204          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
 205          void Uart1InterruptReceive(void) interrupt 4
 206          {
 207   1              char tmp = 0;
 208   1              unsigned char i = 0;
 209   1              if(RI)
 210   1              {
 211   2      
 212   2                      ES=0;//¹Ø´®ÐÐ¿ÚÖÐ¶Ï
 213   2                      RI=0;//½ÓÊÕÖÐ¶ÏÐÅºÅÇåÁã£¬±íÊ¾½«¼ÌÐø½ÓÊÕ
 214   2                      while(RI!=0);
 215   2                      while(ES!=0);
 216   2      
 217   2      
 218   2                      tmp = SBUF;
 219   2                      ES=1;//¿ª´®ÐÐ¿ÚÖÐ¶Ï     
 220   2              }       
 221   1      }
 222          
 223          
 224          
 225          
 226          
 227          
 228          /*////////////////////////////////////////////////////////////////////////////////////////////////////
 229          // º¯ÊýÃû: void Uart2InterruptReceive(void)
 230          // ×÷ÓÃ:  ´®¿Ú2µÄÖÐ¶Ïº¯Êý£¬ÓÃÓÚ±£´æ½ÓÊÕµ½µÄgprs´«À´µÄÊý¾Ý£¬
 231                                  µ± GprsFlagInfoAble=1£¬Ê±ËµÃ÷µ±Ç°±£´æµ½gprs_dat_recv[0]-gprs_dat_recv[GprsRecvCntAt]ÖÐ´æ·ÅµÄÊÇÒ»¸öÍêÕûµ
             -Äat»Ø¸´Ö¸Áî£¬
 232                                  ±ØÐëÂíÉÏ¶Á³ö³öÀ´£¬·ñÔòÏÂÒ»¸öÊý¾Ýµ½À´ºó¸ÃÖ¸Áî½«±»È¡´ú¡£
 233                                   GprsFlagInfoStart ÔÚ½ÓÊÕÐÅÏ¢Ê±¸ÃÎ»ÖÃ1£¬½ÓÊÕÍêÒ»×éÍêÕûat»Ø¸´Ö¸ÁîÇå0
 234          // ²ÎÊý:  void
 235          // ·µ»Ø:  void
 236          ////////////////////////////////////////////////////////////////////////////////////////////////////*/
 237          void Uart2InterruptReceive(void) interrupt 8
 238          {
 239   1              unsigned char tmp = 0;
 240   1              char i = 0;
C51 COMPILER V9.00   GPRS                                                                  05/24/2011 20:52:59 PAGE 5   

 241   1      
 242   1              IE2 &= (~ES2);//¹Ø±Õ´®¿Ú2ÖÐ¶Ï//ES2 = 0;
 243   1              if(S2CON & S2RI)        //if(S2RI == 1)
 244   1              {
 245   2      
 246   2                      S2CON &= (~S2RI);//S2RI = 0;
 247   2                      tmp = S2BUF;
 248   2                      Uart1Send(tmp);
 249   2              }
 250   1              else
 251   1              {
 252   2                      S2CON &= (~S2TI);//S2TI = 0;
 253   2              }
 254   1      
 255   1              IE2 |= ES2;//ES2 = 1;
 256   1      }
 257          
 258          
 259          
 260          
 261          
 262          
 263          
 264          
 265          
 266          
 267          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    364    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
